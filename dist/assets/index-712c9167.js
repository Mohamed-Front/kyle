import{_ as F,u as G,r as v,O as H,o as J,g as p,a as V,c as B,b as o,d as l,w as s,h as I,i as N,e as x,z as K,t as k,l as z,j as E,A as q,p as Q,f as R}from"./index-5ffc309d.js";const c=g=>(Q("data-v-57539d8c"),g=g(),R(),g),W={class:"organization-page"},X={class:"card"},Y=c(()=>l("h1",null,"الهيكل التنظيمي",-1)),Z={class:"flex flex-column"},P=["alt"],ee={class:"mt-3 font-medium text-lg"},te=["onClick"],le={class:"node-title"},oe={class:"node-name pt-1"},ae={class:"node-actions"},ne={class:"field"},ie=c(()=>l("label",{for:"name"},"الاسم",-1)),se={class:"field"},de=c(()=>l("label",{for:"title"},"المنصب",-1)),ue={key:0,class:"field"},re=c(()=>l("label",{for:"parent"},"المدير المباشر",-1)),ce={class:"field"},pe=c(()=>l("label",{for:"newName"},"الاسم",-1)),ve={class:"field"},me=c(()=>l("label",{for:"newTitle"},"المنصب",-1)),_e={class:"field"},fe=c(()=>l("label",{for:"parent"},"المدير المباشر",-1)),be={class:"confirmation-content"},he=c(()=>l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ge=q("هل أنت متأكد من حذف "),ye=q("؟"),Ve={setup(g){const u=G(),m=v(null),_=v(!1),f=v(!1),b=v(!1),i=v({}),d=v({name:"",title:"",parent_id:null}),T=H(()=>{if(!m.value)return[];const a=r=>{let n=[r];return r.children&&r.children.length>0&&r.children.forEach(C=>{n=n.concat(a(C))}),n};return a(m.value).filter(r=>{var n;return r.id!==((n=i.value)==null?void 0:n.id)})}),h=()=>{x.get("api/organizational-structure").then(a=>{m.value=a.data.data[0],u.add({severity:"success",summary:"نجاح",detail:"تم تحميل البيانات بنجاح",life:3e3})}).catch(a=>{u.add({severity:"error",summary:"خطأ",detail:"فشل في تحميل البيانات",life:3e3}),console.error("خطأ في جلب البيانات:",a)})},$=a=>{i.value={...a},_.value=!0},O=a=>{d.value={name:"",title:"",parent_id:a.id},f.value=!0},S=()=>{x.put(`api/organizational-structure/${i.value.id}`,{name:i.value.name,title:i.value.title,parent_id:i.value.parent_id}).then(()=>{u.add({severity:"success",summary:"نجاح",detail:"تم حفظ التغييرات بنجاح",life:3e3}),h(),_.value=!1}).catch(a=>{u.add({severity:"error",summary:"خطأ",detail:"فشل في حفظ التغييرات",life:3e3}),console.error("خطأ في حفظ التغييرات:",a)})},A=()=>{x.post("api/organizational-structure",d.value).then(()=>{u.add({severity:"success",summary:"نجاح",detail:"تم إضافة الموظف بنجاح",life:3e3}),h(),f.value=!1,d.value={name:"",title:"",parent_id:null}}).catch(a=>{u.add({severity:"error",summary:"خطأ",detail:"فشل في إضافة الموظف",life:3e3}),console.error("خطأ في إضافة الموظف:",a)})},L=a=>{i.value={...a},b.value=!0},M=()=>{x.delete(`api/organizational-structure/${i.value.id}`).then(()=>{u.add({severity:"success",summary:"نجاح",detail:"تم حذف الموظف بنجاح",life:3e3}),h(),b.value=!1}).catch(a=>{u.add({severity:"error",summary:"خطأ",detail:"فشل في حذف الموظف",life:3e3}),console.error("خطأ في حذف الموظف:",a)})};return J(()=>{h()}),(a,t)=>{const r=p("Toast"),n=p("Button"),C=p("Toolbar"),j=p("OrganizationChart"),y=p("InputText"),U=p("Dropdown"),w=p("Dialog");return V(),B("div",W,[o(r),l("div",X,[o(C,{class:"mb-4"},{start:s(()=>[Y]),end:s(()=>[o(n,{label:"تحديث",icon:"pi pi-refresh",class:"p-button-info mr-2",onClick:h})]),_:1}),m.value?(V(),I(j,{key:0,value:m.value},{country:s(e=>[l("div",Z,[l("img",{alt:e.node.title,src:"https://primefaces.org/cdn/primevue/images/flag/flag_placeholder.png",class:K(`w-2rem flag flag-${e.node.data}`)},null,10,P),l("div",ee,k(e.node.title),1)])]),default:s(e=>[l("div",{class:"node-card",onClick:D=>$(e.node)},[l("div",le,k(e.node.name),1),l("div",oe,k(e.node.title),1),l("div",ae,[o(n,{icon:"pi pi-pencil",class:"p-button-rounded p-button-sm p-detail",onClick:z(D=>$(e.node),["stop"])},null,8,["onClick"]),o(n,{icon:"pi pi-plus",class:"p-button-rounded p-button-sm p-detail",onClick:z(D=>O(e.node),["stop"])},null,8,["onClick"]),e.node.parent_id!==null?(V(),I(n,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-sm p-delete",onClick:z(D=>L(e.node),["stop"])},null,8,["onClick"])):N("",!0)])],8,te)]),_:1},8,["value"])):N("",!0)]),o(w,{visible:_.value,"onUpdate:visible":t[4]||(t[4]=e=>_.value=e),header:"تعديل بيانات الموظف",modal:!0,class:"p-fluid",style:{width:"450px"}},{footer:s(()=>[o(n,{label:"إلغاء",icon:"pi pi-times",class:"p-button-text",onClick:t[3]||(t[3]=e=>_.value=!1)}),o(n,{label:"حفظ",icon:"pi pi-check",class:"p-button-text",onClick:S})]),default:s(()=>[l("div",ne,[ie,o(y,{id:"name",modelValue:i.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.name=e),required:"",autofocus:""},null,8,["modelValue"])]),l("div",se,[de,o(y,{id:"title",modelValue:i.value.title,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value.title=e),required:""},null,8,["modelValue"])]),i.value.parent_id!==null?(V(),B("div",ue,[re,o(U,{modelValue:i.value.parent_id,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.parent_id=e),options:E(T),optionLabel:"title",optionValue:"id",placeholder:"اختر المدير"},null,8,["modelValue","options"])])):N("",!0)]),_:1},8,["visible"]),o(w,{visible:f.value,"onUpdate:visible":t[9]||(t[9]=e=>f.value=e),header:"إضافة موظف جديد",modal:!0,class:"p-fluid",style:{width:"450px"}},{footer:s(()=>[o(n,{label:"إلغاء",icon:"pi pi-times",class:"p-button-text",onClick:t[8]||(t[8]=e=>f.value=!1)}),o(n,{label:"حفظ",icon:"pi pi-check",class:"p-button-text",onClick:A})]),default:s(()=>[l("div",ce,[pe,o(y,{id:"newName",modelValue:d.value.name,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value.name=e),required:"",autofocus:""},null,8,["modelValue"])]),l("div",ve,[me,o(y,{id:"newTitle",modelValue:d.value.title,"onUpdate:modelValue":t[6]||(t[6]=e=>d.value.title=e),required:""},null,8,["modelValue"])]),l("div",_e,[fe,o(U,{modelValue:d.value.parent_id,"onUpdate:modelValue":t[7]||(t[7]=e=>d.value.parent_id=e),options:E(T),optionLabel:"title",optionValue:"id",placeholder:"اختر المدير"},null,8,["modelValue","options"])])]),_:1},8,["visible"]),o(w,{visible:b.value,"onUpdate:visible":t[11]||(t[11]=e=>b.value=e),header:"تأكيد الحذف",modal:!0,style:{width:"350px"}},{footer:s(()=>[o(n,{label:"لا",icon:"pi pi-times",class:"p-button-text",onClick:t[10]||(t[10]=e=>b.value=!1)}),o(n,{label:"نعم",icon:"pi pi-check",class:"p-button-text",onClick:M})]),default:s(()=>{var e;return[l("div",be,[he,l("span",null,[ge,l("b",null,k((e=i.value)==null?void 0:e.title),1),ye])])]}),_:1},8,["visible"])])}}},ke=F(Ve,[["__scopeId","data-v-57539d8c"]]);export{ke as default};
