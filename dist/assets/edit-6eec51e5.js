import{_ as B,O as M,M as A,v as E,i as r,j as G,o as m,c as v,a as t,h as o,g as s,P as x,b as f,p as J,F as L,s as $,E as O,A as S,R as W,Q,J as h,C as H}from"./index-063be7f6.js";const K={class:"max-w-4xl mx-auto p-6",dir:"rtl"},X={class:"bg-white rounded-2xl shadow-2xl overflow-hidden"},Y={key:0,class:"flex flex-column align-items-center py-16"},Z={key:1,class:"p-8"},ee={key:0,class:"space-y-6"},te=["src"],ae={class:"flex justify-center gap-4"},le={class:"cursor-pointer"},se={key:1,class:"space-y-5"},re={class:"flex justify-center gap-6 pt-12"},oe={__name:"edit",setup(ie){const _=M(),P=A(),i=E(),k=P.params.id,d=r(""),u=r(""),n=r(null),p=r(""),c=r(null),g=r(null),y=r(!1),w=r(!0),b=r(!1),I=async()=>{w.value=!0;try{const e=(await $.get(`/api/product/${k}`)).data.data;d.value=e.name||"",u.value=e.description||"",n.value=parseFloat(e.price)||null,p.value=e.product_image||""}catch{i.add({severity:"error",summary:"خطأ",detail:"فشل تحميل بيانات المنتج",life:5e3}),_.push({name:"products"})}finally{w.value=!1}},R=a=>{a.preventDefault(),y.value=!0},T=()=>{y.value=!1},U=a=>{a.preventDefault(),y.value=!1;const e=a.dataTransfer.files[0];e&&e.type.startsWith("image/")?V(e):i.add({severity:"warn",summary:"ملف غير صالح",detail:"يرجى رفع صورة فقط",life:3e3})},D=a=>{const e=a.target.files[0];e&&V(e)},V=a=>{if(a.size>10*1024*1024){i.add({severity:"warn",summary:"الحجم كبير",detail:"يجب ألا يتجاوز حجم الصورة 10 ميجابايت",life:4e3});return}c.value=a;const e=new FileReader;e.onload=l=>{g.value=l.target.result},e.readAsDataURL(a)},j=()=>{c.value=null,g.value=null,p.value="";const a=document.querySelector('input[type="file"]');a&&(a.value="")},q=async()=>{var e,l,F,C;if(!((e=d.value)!=null&&e.trim())){i.add({severity:"error",summary:"حقل مطلوب",detail:"اسم المنتج مطلوب",life:3e3});return}if(!((l=u.value)!=null&&l.trim())){i.add({severity:"error",summary:"حقل مطلوب",detail:"الوصف مطلوب",life:3e3});return}if(!n.value||n.value<=0){i.add({severity:"error",summary:"حقل مطلوب",detail:"السعر يجب أن يكون أكبر من صفر",life:3e3});return}b.value=!0;const a=new FormData;a.append("name",d.value.trim()),a.append("description",u.value.trim()),a.append("price",n.value),a.append("_method","post"),c.value&&a.append("product_image",c.value),!p.value&&c.value===null&&a.append("remove_image","1");try{await $.post(`/api/product/${k}`,a,{headers:{"Content-Type":"multipart/form-data"}}),i.add({severity:"success",summary:"تم بنجاح!",detail:"تم تعديل المنتج بنجاح",life:4e3}),setTimeout(()=>{_.push({name:"products"})},1500)}catch(N){const z=((C=(F=N.response)==null?void 0:F.data)==null?void 0:C.message)||"فشل تعديل المنتج";i.add({severity:"error",summary:"خطأ",detail:z,life:5e3})}finally{b.value=!1}};return G(()=>{I()}),(a,e)=>(m(),v(L,null,[t("div",K,[t("div",X,[e[10]||(e[10]=t("div",{class:"bg-gradient-to-l from-[#1d1a1a] to-[#474444] px-8 py-7"},[t("h1",{class:"text-3xl font-bold text-white text-center"}," تعديل المنتج "),t("p",{class:"text-center text-white/90 mt-2 text-lg"},"قم بتحديث بيانات المنتج")],-1)),w.value?(m(),v("div",Y,[o(s(O),{style:{width:"70px",height:"70px"}}),e[4]||(e[4]=t("p",{class:"mt-4 text-xl text-gray-600"},"جاري تحميل بيانات المنتج...",-1))])):(m(),v("div",Z,[t("form",{onSubmit:x(q,["prevent"]),class:"space-y-9"},[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[f(" اسم المنتج "),t("span",{class:"text-red-500"},"*")],-1)),o(s(S),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),placeholder:"مثال: آيفون 15 برو ماكس - 256 جيجا",class:"w-full text-lg py-3",required:""},null,8,["modelValue"])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[f(" السعر (ر.س) "),t("span",{class:"text-red-500"},"*")],-1)),o(s(W),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),min:0,max:999999,step:.01,mode:"decimal",minFractionDigits:2,maxFractionDigits:2,placeholder:"مثال: 4599.00",class:"w-full",inputClass:"text-lg py-3 text-right",required:""},null,8,["modelValue"])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[f(" وصف المنتج "),t("span",{class:"text-red-500"},"*")],-1)),o(s(Q),{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),rows:"6",placeholder:"اكتب وصفًا مفصلًا عن المنتج، المواصفات، المميزات...",class:"w-full text-base",required:""},null,8,["modelValue"])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-bold text-gray-700 mb-3"},[f(" صورة المنتج "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{onDragover:x(R,["prevent"]),onDragleave:x(T,["prevent"]),onDrop:x(U,["prevent"]),class:J(["relative border-3 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all duration-300 shadow-md",y.value?"border-blue-600 bg-blue-50/70":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"])},[t("input",{type:"file",accept:"image/*",onChange:D,class:"absolute inset-0 opacity-0 cursor-pointer z-10"},null,32),g.value||p.value?(m(),v("div",ee,[t("img",{src:g.value||p.value,alt:"معاينة صورة المنتج",class:"mx-auto max-h-96 rounded-xl shadow-2xl object-cover border-4 border-white"},null,8,te),t("div",ae,[o(s(h),{type:"button",label:"إزالة الصورة",icon:"pi pi-trash",severity:"danger",outlined:"",onClick:x(j,["stop"])}),t("label",le,[o(s(h),{label:"تغيير الصورة",icon:"pi pi-camera",outlined:""}),t("input",{type:"file",accept:"image/*",onChange:D,class:"hidden"},null,32)])])])):(m(),v("div",se,[...e[8]||(e[8]=[t("i",{class:"pi pi-image text-7xl text-gray-400"},null,-1),t("div",null,[t("p",{class:"text-xl font-bold text-gray-700"},[t("span",{class:"text-blue-600 font-extrabold"},"اضغط للرفع"),f(" أو اسحب وأفلت الصورة هنا ")]),t("p",{class:"text-sm text-gray-500 mt-2"}," المقاس الموصى: 800×800 أو أكبر • صيغ PNG، JPG، WebP • الحد الأقصى 10 ميجابايت ")],-1)])]))],34)]),t("div",re,[o(s(h),{type:"button",label:"إلغاء",icon:"pi pi-times",severity:"secondary",outlined:"",onClick:e[3]||(e[3]=l=>s(_).back()),disabled:b.value,class:"px-10 py-3 text-lg"},null,8,["disabled"]),o(s(h),{type:"submit",label:"حفظ التغييرات",icon:"pi pi-check",loading:b.value,class:"px-12 py-3 text-lg font-bold"},null,8,["loading"])])],32)]))])]),o(s(H),{position:"top-right"})],64))}},de=B(oe,[["__scopeId","data-v-84d1a28f"]]);export{de as default};
