import{_ as q,v as z,w as I,i as n,x as K,j as M,y as U,o as y,c as A,a as i,h as a,z as l,g as t,s as L,A as F,B as H,C as J,D as O,E as Q,G as c,b as D,t as h,H as W,I as _,J as f,K as x,q as k,p as X,L as Y}from"./index-b48caa78.js";const Z={class:"grid",dir:"rtl"},ee={class:"col-12"},te={class:"card p-4 shadow-2 border-round"},se={class:"p-input-icon-left"},ae=["href"],oe={class:"flex gap-2 justify-content-center"},re={class:"flex justify-content-center align-items-center py-8"},ie={__name:"index",setup(ne){const b=z(),S=I(),w=n(!0),P=n([]),p=n(""),$=n(null),g=n(1),u=n(10),C=n(0),V=n(1),B=n(0),j=n(0),m=n({}),v=async()=>{w.value=!0;try{const s=(await L.get("/api/registration",{params:{page:g.value,limit:u.value,search:p.value}})).data;if(s.success){P.value=s.data;const o=s.pagination||{};C.value=o.total||0,V.value=o.last_page||1,B.value=o.from||0,j.value=o.to||0,g.value=o.current_page||1,u.value=o.per_page||10}}catch(r){b.add({severity:"error",summary:"خطأ",detail:"فشل تحميل طلبات التسجيل",life:3e3}),console.error("Error fetching registrations:",r)}finally{w.value=!1}},R=async(r,s,o)=>{S.require({message:`هل أنت متأكد من تحديث حالة الطلب إلى "${o}"؟`,header:"تأكيد العملية",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم، تأكيد",rejectLabel:"إلغاء",accept:async()=>{var e,d;m.value[r]=!0;try{await L.post(`/api/registration/change-status/${r}`,{status:s}),b.add({severity:"success",summary:"تم بنجاح",detail:`تم تحديث الحالة إلى "${o}"`,life:3e3}),await v()}catch(T){const G=((d=(e=T.response)==null?void 0:e.data)==null?void 0:d.message)||"فشل تحديث الحالة";b.add({severity:"error",summary:"خطأ",detail:G,life:5e3})}finally{delete m.value[r]}}})};K([p,u],()=>{g.value=1,v()});const E=r=>{u.value=r.rows,g.value=r.page+1,v()},N=r=>{switch(r){case 1:return"info";case 2:return"warn";case 3:return"primary";case 4:return"help";case 5:return"success";case 6:return"danger";default:return"secondary"}};return M(()=>{v()}),(r,s)=>{const o=U("tooltip");return y(),A("div",Z,[i("div",ee,[i("div",te,[a(t(H),{class:"mb-4"},{start:l(()=>[...s[2]||(s[2]=[i("h2",{class:"text-2xl font-bold"},"إدارة طلبات التسجيل",-1)])]),end:l(()=>[i("span",se,[s[3]||(s[3]=i("i",{class:"pi pi-search"},null,-1)),a(t(F),{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),placeholder:"البحث بالاسم أو البريد الإلكتروني أو رقم الجوال...",class:"w-full md:w-20rem"},null,8,["modelValue"])])]),_:1}),a(t(J),{position:"top-right"}),a(t(O)),a(t(Y),{value:P.value,loading:w.value,dataKey:"id",selection:$.value,"onUpdate:selection":s[1]||(s[1]=e=>$.value=e),responsiveLayout:"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:!0,rows:u.value,totalRecords:C.value,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"عرض {first} إلى {last} من إجمالي {totalRecords}",onPage:E,dir:"rtl"},{empty:l(()=>[...s[4]||(s[4]=[i("div",{class:"text-center py-8 text-gray-500"},[i("i",{class:"pi pi-inbox text-4xl mb-3"}),i("p",{class:"text-xl"},"لا توجد طلبات تسجيل")],-1)])]),loading:l(()=>[i("div",re,[a(t(Q),{style:{width:"50px",height:"50px"}}),s[5]||(s[5]=i("span",{class:"mr-3 text-lg"},"جاري التحميل...",-1))])]),default:l(()=>[a(t(c),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(t(c),{field:"id",header:"الرقم التعريفي",sortable:"",style:{"min-width":"4rem"}},{body:l(({data:e})=>[D(" #"+h(e.id),1)]),_:1}),a(t(c),{field:"name",header:"الاسم الكامل",sortable:"",style:{"min-width":"12rem"}},{body:l(({data:e})=>[i("strong",null,h(e.name),1)]),_:1}),a(t(c),{field:"email",header:"البريد الإلكتروني",sortable:""},{body:l(({data:e})=>[i("a",{href:`mailto:${e.email}`,class:"text-primary hover:underline"},h(e.email),9,ae)]),_:1}),a(t(c),{field:"whatsapp",header:"واتساب",sortable:""}),a(t(c),{field:"date_of_birth",header:"تاريخ الميلاد",sortable:""},{body:l(({data:e})=>[D(h(new Date(e.date_of_birth).toLocaleDateString("ar-EG")),1)]),_:1}),a(t(c),{field:"status_description",header:"الحالة",sortable:"",style:{"min-width":"10rem"}},{body:l(({data:e})=>[a(t(W),{value:e.status_description,severity:N(e.status),class:"text-sm"},null,8,["value","severity"])]),_:1}),a(t(c),{header:"الإجراءات",style:{"min-width":"14rem","text-align":"center"}},{body:l(({data:e})=>[i("div",oe,[_(a(t(f),{icon:"pi pi-eye",class:"p-button-rounded p-button-info p-button-sm",onClick:d=>r.$router.push({name:"registration-show",params:{id:e.id}})},null,8,["onClick"]),[[o,"عرض التفاصيل",void 0,{top:!0}]]),e.status!==4&&e.status!==5?_((y(),x(t(f),{key:0,icon:"pi pi-check",class:"p-button-rounded p-button-help p-button-sm",loading:m.value[e.id],onClick:d=>R(e.id,4,"تحت المعالجة")},null,8,["loading","onClick"])),[[o,"قبول وبدء المعالجة",void 0,{top:!0}]]):k("",!0),e.status!==5?_((y(),x(t(f),{key:1,icon:"pi pi-times",class:"p-button-rounded p-button-danger p-button-sm",loading:m.value[e.id],onClick:d=>R(e.id,5,"مغلق")},null,8,["loading","onClick"])),[[o,"رفض أو إغلاق الطلب",void 0,{top:!0}]]):k("",!0),e.status===4||e.status===5?_((y(),x(t(f),{key:2,icon:e.status===4?"pi pi-clock":"pi pi-check-circle",class:X(["p-button-rounded p-button-sm",e.status===4?"p-button-help":"p-button-success"]),disabled:""},null,8,["icon","class"])),[[o,e.status===4?"تحت المعالجة":"مغلق",void 0,{top:!0}]]):k("",!0)])]),_:1})]),_:1},8,["value","loading","selection","rows","totalRecords"])])])])}}},ce=q(ie,[["__scopeId","data-v-da62230b"]]);export{ce as default};
