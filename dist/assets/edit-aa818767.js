import{_ as U,O as j,M as B,v as N,i as o,j as O,o as c,c as v,a as t,P as _,b as $,h as i,g as n,p as z,F as J,s as M,A as L,Q,S as W,J as h,E as q,C as G}from"./index-063be7f6.js";const H={class:"max-w-5xl mx-auto p-6",dir:"rtl"},K={class:"bg-white rounded-2xl shadow-2xl overflow-hidden"},X={key:0,class:"p-8"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z={key:0},ee=["src"],te={key:1,class:"space-y-4"},ae={class:"flex justify-center gap-6 pt-10"},se={key:1,class:"flex flex-column align-items-center py-16"},le={__name:"edit",setup(oe){const k=j(),T=B(),r=N(),I=T.params.id,u=o(""),p=o(""),m=o(null),D=o(!0),g=o(!1),f=o(""),y=o(null),x=o(null),C=o([]),F=o([]),S=o([]),b=o(!1);o(!1);const A=async()=>{var a,e;D.value=!0;try{const l=(await M.get(`/api/post/${I}`)).data.data;u.value=l.title||"",p.value=l.content||"",m.value=l.date?new Date(l.date):null;const w=(a=l.media)==null?void 0:a.find(d=>d.name==="post_main_image");w&&(f.value=w.url),C.value=((e=l.media)==null?void 0:e.filter(d=>d.name==="post_images").map(d=>({id:d.id,url:d.url})))||[]}catch{r.add({severity:"error",summary:"خطأ",detail:"فشل تحميل بيانات المقال",life:5e3}),k.push({name:"posts"})}finally{D.value=!1}},V=a=>{if(a.size>10*1024*1024){r.add({severity:"warn",summary:"حجم كبير",detail:"الحد الأقصى 10 ميجابايت",life:4e3});return}y.value=a;const e=new FileReader;e.onload=s=>{x.value=s.target.result},e.readAsDataURL(a)},E=()=>{y.value=null,x.value=null,f.value=""},P=a=>{a.preventDefault(),b.value=!1;const e=a.dataTransfer.files[0];e&&e.type.startsWith("image/")&&V(e)},R=async()=>{var e,s;if(!u.value.trim())return r.add({severity:"error",summary:"مطلوب",detail:"العنوان مطلوب"});if(!p.value.trim())return r.add({severity:"error",summary:"مطلوب",detail:"المحتوى مطلوب"});g.value=!0;const a=new FormData;if(a.append("title",u.value.trim()),a.append("content",p.value.trim()),a.append("_method","POST"),m.value){const l=new Date(m.value);a.append("date",l.toISOString().split("T")[0])}y.value&&a.append("post_main_image",y.value),F.value.forEach(l=>{a.append("post_images[]",l.file)}),S.value.forEach(l=>{a.append("delete_images[]",l)});try{await M.post(`/api/post/${I}`,a,{headers:{"Content-Type":"multipart/form-data"}}),r.add({severity:"success",summary:"تم التحديث!",detail:"تم تعديل المقال بنجاح",life:4e3}),setTimeout(()=>{k.push({name:"posts"})},1500)}catch(l){const w=((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||"فشل تحديث المقال";r.add({severity:"error",summary:"خطأ",detail:w,life:6e3})}finally{g.value=!1}};return O(()=>{A()}),(a,e)=>(c(),v(J,null,[t("div",H,[t("div",K,[e[13]||(e[13]=t("div",{class:"bg-gradient-to-l from-[#1d1a1a] to-[#474444] px-8 py-7"},[t("h1",{class:"text-3xl font-bold text-white text-center"}," تعديل المقال "),t("p",{class:"text-center text-white/90 mt-2 text-lg"},"قم بتحديث محتوى المقال والصور")],-1)),D.value?(c(),v("div",se,[i(n(q),{style:{width:"70px",height:"70px"}}),e[12]||(e[12]=t("p",{class:"mt-4 text-xl text-gray-600"},"جاري تحميل بيانات المقال...",-1))])):(c(),v("div",X,[t("form",{onSubmit:_(R,["prevent"]),class:"space-y-10"},[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[$("عنوان المقال "),t("span",{class:"text-red-500"},"*")],-1)),i(n(L),{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"w-full text-lg py-3",placeholder:"عنوان المقال"},null,8,["modelValue"])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[$("محتوى المقال "),t("span",{class:"text-red-500"},"*")],-1)),i(n(Q),{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),rows:"10",class:"w-full text-base"},null,8,["modelValue"])]),t("div",Y,[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"تاريخ النشر",-1)),i(n(W),{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),dateFormat:"yy-mm-dd",showIcon:"",class:"w-full"},null,8,["modelValue"])])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-bold text-gray-700 mb-3"},"الصورة الرئيسية",-1)),t("div",{onDragover:e[4]||(e[4]=_(s=>b.value=!0,["prevent"])),onDragleave:e[5]||(e[5]=_(s=>b.value=!1,["prevent"])),onDrop:_(P,["prevent"]),class:z(["relative border-3 border-dashed rounded-2xl p-10 text-center transition-all",b.value?"border-blue-600 bg-blue-50":"border-gray-300"])},[t("input",{type:"file",accept:"image/*",onChange:e[3]||(e[3]=s=>V(s.target.files[0])),class:"absolute inset-0 opacity-0 cursor-pointer"},null,32),x.value||f.value?(c(),v("div",Z,[t("img",{src:x.value||f.value,class:"mx-auto max-h-96 rounded-xl shadow-lg object-cover"},null,8,ee),i(n(h),{type:"button",label:"تغيير الصورة",icon:"pi pi-camera",class:"mt-4",outlined:""}),i(n(h),{type:"button",label:"إزالة",icon:"pi pi-trash",severity:"danger",outlined:"",class:"mt-2 mr-2",onClick:E})])):(c(),v("div",te,[...e[10]||(e[10]=[t("i",{class:"pi pi-image text-6xl text-gray-400"},null,-1),t("p",{class:"text-xl font-bold"},"اسحب الصورة الرئيسية أو اضغط للرفع",-1)])]))],34)]),t("div",ae,[i(n(h),{type:"button",label:"إلغاء",icon:"pi pi-times",severity:"secondary",outlined:"",onClick:e[6]||(e[6]=s=>n(k).back()),disabled:g.value},null,8,["disabled"]),i(n(h),{type:"submit",label:"حفظ التغييرات",icon:"pi pi-check",loading:g.value,class:"px-12 py-3 text-lg font-bold"},null,8,["loading"])])],32)]))])]),i(n(G),{position:"top-right"})],64))}},ie=U(le,[["__scopeId","data-v-a221fb7d"]]);export{ie as default};
