import{_ as ie,R as de,u as re,r as s,U as ce,S as pe,o as ue,g as d,H as G,a as C,c as S,d as t,b as a,w as n,I as b,h as me,t as r,F as ve,B as _e,i as he,V as be,e as I,A as g,z as ge,p as fe,f as ye}from"./index-5ffc309d.js";const u=V=>(fe("data-v-863430bd"),V=V(),ye(),V),we={class:"grid"},xe={class:"col-12"},ke={class:"card p-4 shadow-2 border-round"},Ce=u(()=>t("h2",{class:"text-2xl font-bold"},"الشكاوى",-1)),Ve={class:"flex gap-2"},De={class:"p-input-icon-left"},Te=u(()=>t("i",{class:"pi pi-search"},null,-1)),$e={class:"card shadow-1 surface-0"},Se=u(()=>t("div",{class:"text-center py-4"},[t("i",{class:"pi pi-exclamation-circle text-2xl mb-2"}),t("p",{class:"text-xl"},"لا توجد بيانات")],-1)),Ie={class:"flex justify-content-center align-items-center py-4"},Ne={key:0,class:"p-paginator p-component p-unselectable-text mt-3"},Be={class:"p-paginator-left-content"},Re={class:"p-paginator-current"},Ue={class:"p-paginator-right-content"},Me={class:"p-paginator-pages"},Pe=["disabled"],ze=u(()=>t("span",{class:"p-paginator-icon pi pi-angle-double-left"},null,-1)),Fe=[ze],je=["disabled"],Ae=u(()=>t("span",{class:"p-paginator-icon pi pi-angle-left"},null,-1)),Le=[Ae],Oe=["onClick"],Ee=["disabled"],Ge=u(()=>t("span",{class:"p-paginator-icon pi pi-angle-right"},null,-1)),He=[Ge],Qe=["disabled"],We=u(()=>t("span",{class:"p-paginator-icon pi pi-angle-double-right"},null,-1)),qe=[We],Je={class:"p-paginator-rpp-options"},Ke=u(()=>t("div",{class:"flex align-items-center justify-content-center"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}}),t("span",null,"هل أنت متأكد من حذف هذه الشكوى؟")],-1)),Xe={class:"field"},Ye=u(()=>t("label",{for:"notes"},"الملاحظات",-1)),Ze={setup(V){const U=de(),m=re(),D=s(!0),M=s(""),P=s(null),f=s(!1),y=s(!1);s(null);const z=s(null),F=s({}),T=s(""),w=s(""),j=s(null),i=s(1),N=s(0),x=s(10),v=s(0),A=s(0),L=s(0),H=s([{label:"انتظار",value:2},{label:"نشط",value:1},{label:"مرفوضة",value:3},{label:"يتم العمل عليها",value:4},{label:"مغلقة",value:5}]),Q=()=>{z.value.exportCSV()},W=o=>{M.value=o,f.value=!0},q=()=>{I.delete(`/api/complaint/${M.value}`).then(()=>{_(),f.value=!1,m.add({severity:"success",summary:"نجاح",detail:"تم حذف الشكوى بنجاح",life:3e3})}).catch(o=>{m.add({severity:"error",summary:"خطأ",detail:"فشل في حذف الشكوى",life:3e3})})},J=o=>{j.value=o,w.value="",y.value=!0},K=()=>{if(!w.value.trim()){m.add({severity:"warn",summary:"تحذير",detail:"الملاحظات مطلوبة",life:3e3});return}I.post(`/api/complaint/add/notes/${j.value}`,{notes:w.value}).then(()=>{_(),y.value=!1,m.add({severity:"success",summary:"نجاح",detail:"تم إضافة الملاحظات بنجاح",life:3e3})}).catch(o=>{m.add({severity:"error",summary:"خطأ",detail:"فشل في إضافة الملاحظات",life:3e3})})},X=(o,l)=>{I.post(`/api/complaint/change/status/${o}`,{status:l}).then(()=>{_(),m.add({severity:"success",summary:"نجاح",detail:"تم تحديث الحالة بنجاح",life:3e3})}).catch(B=>{m.add({severity:"error",summary:"خطأ",detail:"فشل في تحديث الحالة",life:3e3}),console.error("خطأ في تحديث الحالة:",B)})},Y=()=>{F.value={global:{value:null,matchMode:be.CONTAINS}}};ce(()=>{Y()});const _=()=>{D.value=!0,I.get("/api/complaint",{params:{page:i.value,limit:x.value,search:T.value}}).then(o=>{D.value=!1,P.value=o.data.data,N.value=o.data.pagination.total,v.value=o.data.pagination.last_page,A.value=o.data.pagination.from,L.value=o.data.pagination.to}).catch(o=>{D.value=!1,m.add({severity:"error",summary:"خطأ",detail:"فشل في تحميل البيانات",life:3e3}),console.error("خطأ في جلب البيانات:",o)})};pe(T,()=>{i.value=1,_()});const k=o=>{o>=1&&o<=v.value&&(i.value=o,_())},Z=o=>{x.value=o,i.value=1,_()};ue(()=>{_()});const ee=()=>{U.push({name:"complaint-create"})},te=o=>{U.push({name:"complaint_show",params:{id:o}})};return(o,l)=>{const B=d("InputText"),c=d("Button"),ae=d("Toolbar"),le=d("Toast"),p=d("Column"),O=d("Dropdown"),oe=d("ProgressSpinner"),se=d("DataTable"),E=d("Dialog"),ne=d("Textarea"),$=G("can"),R=G("tooltip");return C(),S("div",we,[t("div",xe,[t("div",ke,[a(ae,{class:"mb-4"},{start:n(()=>[Ce]),end:n(()=>[t("div",Ve,[t("span",De,[Te,a(B,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=e=>T.value=e),placeholder:"البحث"},null,8,["modelValue"])]),b(a(c,{label:"تصدير",icon:"pi pi-upload",class:"p-export",onClick:Q},null,512),[[$,"export complaints"]]),b(a(c,{label:"إضافة شكوى",icon:"pi pi-plus",class:"p-button-success",onClick:ee},null,512),[[$,"create complaints"]])])]),_:1}),a(le),t("div",$e,[b((C(),me(se,{ref_key:"dt",ref:z,value:P.value,loading:D.value,"data-key":"id",paginator:!1,rows:x.value,filters:F.value,totalRecords:N.value,"responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:n(()=>[Se]),loading:n(()=>[t("div",Ie,[a(oe,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:n(()=>[a(p,{"selection-mode":"multiple","header-style":"width: 3rem"}),a(p,{field:"number",header:"رقم الشكوى",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[g(r(e.data.number),1)]),_:1}),a(p,{field:"name",header:"الاسم",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[g(r(e.data.name),1)]),_:1}),a(p,{field:"email",header:"البريد الإلكتروني",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[g(r(e.data.email),1)]),_:1}),a(p,{field:"phone",header:"رقم الهاتف",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[g(r(e.data.phone),1)]),_:1}),a(p,{field:"date",header:"التاريخ",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[g(r(e.data.date),1)]),_:1}),a(p,{field:"complaint",header:"تفاصيل الشكوى",sortable:!0,"header-style":"width:20%; min-width:15rem;"},{body:n(e=>[g(r(e.data.complaint),1)]),_:1}),a(p,{field:"status",header:"الحالة",sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:n(e=>[a(O,{modelValue:e.data.status,"onUpdate:modelValue":h=>e.data.status=h,options:H.value,optionLabel:"label",optionValue:"value",placeholder:"اختر الحالة",class:"w-full",onChange:h=>X(e.data.id,h.value)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),a(p,{header:"الإجراءات","header-style":"min-width:12rem;"},{body:n(e=>[b(a(c,{icon:"pi pi-pencil",class:"p-detail",onClick:h=>te(e.data.id)},null,8,["onClick"]),[[$,"edit complaints"],[R,"تعديل",void 0,{top:!0}]]),b(a(c,{icon:"pi pi-trash mx-2",class:"p-delete",onClick:h=>W(e.data.id)},null,8,["onClick"]),[[R,"حذف",void 0,{top:!0}]]),b(a(c,{icon:"pi pi-comment",class:"p-button-info",onClick:h=>J(e.data.id)},null,8,["onClick"]),[[R,"إضافة ملاحظات",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading","rows","filters","totalRecords"])),[[$,"list complaints"]]),v.value>0?(C(),S("div",Ne,[t("div",Be,[t("span",Re," عرض "+r(A.value)+" إلى "+r(L.value)+" من "+r(N.value)+" سجل ",1)]),t("div",Ue,[t("span",Me,[t("button",{class:"p-paginator-first p-paginator-element p-link",disabled:i.value===1,onClick:l[1]||(l[1]=e=>k(1))},Fe,8,Pe),t("button",{class:"p-paginator-prev p-paginator-element p-link",disabled:i.value===1,onClick:l[2]||(l[2]=e=>k(i.value-1))},Le,8,je),(C(!0),S(ve,null,_e(v.value,e=>(C(),S("button",{key:e,class:ge(["p-paginator-page p-paginator-element p-link",{"p-highlight":i.value===e}]),onClick:h=>k(e)},r(e),11,Oe))),128)),t("button",{class:"p-paginator-next p-paginator-element p-link",disabled:i.value===v.value,onClick:l[3]||(l[3]=e=>k(i.value+1))},He,8,Ee),t("button",{class:"p-paginator-last p-paginator-element p-link",disabled:i.value===v.value,onClick:l[4]||(l[4]=e=>k(v.value))},qe,8,Qe)]),t("span",Je,[a(O,{modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=e=>x.value=e),options:[5,10,20,30],onChange:l[6]||(l[6]=e=>Z(e.value)),class:"ml-2",style:{width:"100px"}},null,8,["modelValue"])])])])):he("",!0)]),a(E,{visible:f.value,"onUpdate:visible":l[8]||(l[8]=e=>f.value=e),style:{width:"450px"},header:"تأكيد الحذف",modal:!0},{footer:n(()=>[a(c,{label:"لا",icon:"pi pi-times",class:"p-button-text",onClick:l[7]||(l[7]=e=>f.value=!1)}),a(c,{label:"نعم",icon:"pi pi-check",class:"p-button-text p-button-danger",onClick:q})]),default:n(()=>[Ke]),_:1},8,["visible"]),a(E,{visible:y.value,"onUpdate:visible":l[11]||(l[11]=e=>y.value=e),style:{width:"450px"},header:"إضافة ملاحظات",modal:!0},{footer:n(()=>[a(c,{label:"إلغاء",icon:"pi pi-times",class:"p-button-text",onClick:l[10]||(l[10]=e=>y.value=!1)}),a(c,{label:"حفظ",icon:"pi pi-check",class:"p-button-text p-button-success",onClick:K})]),default:n(()=>[t("div",Xe,[Ye,a(ne,{id:"notes",modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=e=>w.value=e),autoResize:!0,rows:"5",class:"w-full mt-2",placeholder:"أدخل ملاحظاتك هنا"},null,8,["modelValue"])])]),_:1},8,["visible"])])])])}}},tt=ie(Ze,[["__scopeId","data-v-863430bd"]]);export{tt as default};
