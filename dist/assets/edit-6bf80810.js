import{_ as L,M,O,v as E,i as o,j as P,o as n,c as d,a as t,h as i,g as r,P as m,b,p as S,F as q,s as C,E as A,A as G,Q as J,J as k,C as Q}from"./index-063be7f6.js";const W={class:"max-w-4xl mx-auto p-6",dir:"rtl"},H={class:"bg-white rounded-2xl shadow-2xl overflow-hidden"},K={class:"p-8"},X={key:0,class:"flex flex-column align-items-center py-12"},Y={key:0,class:"space-y-6"},Z=["src"],ee={class:"flex justify-center gap-4"},te={key:1,class:"space-y-6"},ae=["src"],se={key:2,class:"space-y-5"},le={class:"flex justify-center gap-6 pt-12"},oe={__name:"edit",setup(re){const $=M(),p=O(),l=E(),h=$.params.id,u=o(""),c=o(""),_=o(""),v=o(null),g=o(null),x=o(!1),w=o(!0),y=o(!1),j=a=>{a.preventDefault(),x.value=!0},F=()=>{x.value=!1},I=a=>{a.preventDefault(),x.value=!1;const e=a.dataTransfer.files[0];e&&e.type.startsWith("image/")?D(e):l.add({severity:"warn",summary:"ملف غير صالح",detail:"يرجى رفع صورة فقط",life:3e3})},T=a=>{const e=a.target.files[0];e&&D(e)},D=a=>{if(a.size>10*1024*1024){l.add({severity:"warn",summary:"الحجم كبير",detail:"الحد الأقصى 10 ميجابايت",life:4e3});return}v.value=a,g.value=URL.createObjectURL(a)},U=()=>{v.value=null,g.value=null;const a=document.querySelector('input[type="file"]');a&&(a.value="")},N=async()=>{w.value=!0;try{const e=(await C.get(`/api/game/${h}`)).data.data;if(u.value=e.name||"",c.value=e.description||"",e.media&&e.media.length>0){const s=e.media.find(f=>f.name==="game_image");s&&(_.value=s.url)}}catch{l.add({severity:"error",summary:"فشل التحميل",detail:"تعذر جلب بيانات اللعبة",life:5e3}),p.push({name:"games"})}finally{w.value=!1}},R=async()=>{var e,s,f,V;if(!((e=u.value)!=null&&e.trim())){l.add({severity:"error",summary:"مطلوب",detail:"اسم اللعبة مطلوب",life:3e3});return}if(!((s=c.value)!=null&&s.trim())){l.add({severity:"error",summary:"مطلوب",detail:"الوصف مطلوب",life:3e3});return}y.value=!0;const a=new FormData;a.append("name",u.value.trim()),a.append("description",c.value.trim()),a.append("_method","post"),v.value&&a.append("game_image",v.value);try{await C.post(`/api/game/${h}`,a,{headers:{"Content-Type":"multipart/form-data"}}),l.add({severity:"success",summary:"تم التحديث!",detail:"تم تعديل اللعبة بنجاح",life:4e3}),setTimeout(()=>{p.push({name:"games"})},1500)}catch(z){const B=((V=(f=z.response)==null?void 0:f.data)==null?void 0:V.message)||"فشل تحديث اللعبة";l.add({severity:"error",summary:"خطأ",detail:B,life:5e3})}finally{y.value=!1}};return P(()=>{h?N():(l.add({severity:"error",summary:"خطأ",detail:"معرف اللعبة غير موجود",life:4e3}),p.push({name:"games"}))}),(a,e)=>(n(),d(q,null,[t("div",W,[t("div",H,[e[10]||(e[10]=t("div",{class:"bg-gradient-to-l from-[#1d1a1a] to-[#474444] px-8 py-7"},[t("h1",{class:"text-3xl font-bold text-white text-center"}," تعديل اللعبة "),t("p",{class:"text-center text-white/90 mt-2 text-lg"}," قم بتعديل بيانات اللعبة الحالية ")],-1)),t("div",K,[w.value?(n(),d("div",X,[i(r(A),{style:{width:"60px",height:"60px"}}),e[3]||(e[3]=t("p",{class:"mt-4 text-xl text-gray-600"},"جاري تحميل بيانات اللعبة...",-1))])):(n(),d("form",{key:1,onSubmit:m(R,["prevent"]),class:"space-y-9"},[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[b(" اسم اللعبة "),t("span",{class:"text-red-500"},"*")],-1)),i(r(G),{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),placeholder:"اسم اللعبة",class:"w-full text-lg py-3"},null,8,["modelValue"])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[b(" وصف اللعبة "),t("span",{class:"text-red-500"},"*")],-1)),i(r(J),{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),rows:"7",placeholder:"وصف مفصل للعبة...",class:"w-full text-base"},null,8,["modelValue"])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-bold text-gray-700 mb-3"},[b(" صورة اللعبة (الغلاف) "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{onDragover:m(j,["prevent"]),onDragleave:m(F,["prevent"]),onDrop:m(I,["prevent"]),class:S(["relative border-3 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all duration-300 shadow-md",x.value?"border-blue-600 bg-blue-50/70":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"])},[t("input",{type:"file",accept:"image/*",onChange:T,class:"absolute inset-0 opacity-0 cursor-pointer z-10"},null,32),g.value?(n(),d("div",Y,[t("img",{src:g.value,alt:"معاينة الصورة الجديدة",class:"mx-auto max-h-96 rounded-xl shadow-2xl object-cover border-4 border-white"},null,8,Z),t("div",ee,[i(r(k),{type:"button",label:"إزالة الصورة الجديدة",icon:"pi pi-trash",severity:"danger",outlined:"",onClick:m(U,["stop"])})])])):_.value?(n(),d("div",te,[e[6]||(e[6]=t("p",{class:"text-sm text-gray-500 mb-4"},"الصورة الحالية:",-1)),t("img",{src:_.value,alt:"غلاف اللعبة الحالي",class:"mx-auto max-h-96 rounded-xl shadow-2xl object-cover border-4 border-white"},null,8,ae),e[7]||(e[7]=t("p",{class:"text-sm text-gray-500"},"اسحب صورة جديدة أو اضغط لتغيير الغلاف",-1))])):(n(),d("div",se,[...e[8]||(e[8]=[t("i",{class:"pi pi-image text-7xl text-gray-400"},null,-1),t("p",{class:"text-xl font-bold text-gray-700"},[t("span",{class:"text-blue-600 font-extrabold"},"اضغط للرفع"),b(" أو اسحب الصورة هنا ")],-1)])]))],34)]),t("div",le,[i(r(k),{type:"button",label:"إلغاء",icon:"pi pi-times",severity:"secondary",outlined:"",onClick:e[2]||(e[2]=s=>r(p).back()),disabled:y.value,class:"px-10 py-3 text-lg"},null,8,["disabled"]),i(r(k),{type:"submit",label:"حفظ التغييرات",icon:"pi pi-check",loading:y.value,class:"px-12 py-3 text-lg font-bold"},null,8,["loading"])])],32))])])]),i(r(Q),{position:"top-right"})],64))}},ne=L(oe,[["__scopeId","data-v-2467a446"]]);export{ne as default};
